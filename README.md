# Real-Time Healthcare Lakehouse for Patient Monitoring (Synthea, Faker, Kafka, Spark, Delta Lake, BigQuery)

This project builds a **real-time healthcare data lake and analytics platform** for monitoring patient vitals from simulated **IoT wearable devices**, using a combination of **Synthea** for realistic synthetic patient histories and **Faker** for live streaming vitals. Vital signs like heart rate, temperature, and SpO₂ are streamed via **Apache Kafka**, processed in real time using **Spark Structured Streaming**, and stored in **Delta Lake** using a Bronze–Silver–Gold architecture. Cleaned and aggregated data is loaded into **BigQuery** for analysis and visualized using **Looker**. An **anomaly detection ML model** is integrated to identify abnormal vitals in real time, simulating how healthcare providers can respond to emergencies and monitor patient health at scale.

## Project Goals

- **Simulate realistic patient data using Synthea and Faker**

  Use Synthea to generate full synthetic EHR records and vitals distributions.

  Use Faker-guided scripts to simulate real-time streaming data from IoT devices based on Synthea trends.

- **Ingest real-time vitals from simulated IoT patient devices**

  Stream live patient vitals like heart rate, temperature, SpO₂, and blood pressure using Apache Kafka to mimic a hospital monitoring environment.

- **Stream and process data with Spark Structured Streaming**

  Process Kafka streams with schema enforcement, cleansing, timestamp alignment, and enrichment.

- **Store data in Delta Lake using Bronze, Silver, and Gold architecture**
  - Bronze: Raw Kafka ingestion
  - Silver: Parsed, cleaned, and enriched data
  - Gold: Aggregated metrics with anomaly flags

- **Load curated data into BigQuery for analytics**

  Transfer Gold-layer data into Google BigQuery for scalable querying and reporting.

- **Visualize trends and anomalies with Looker Studio**

  Build dashboards for hospital-wide monitoring, patient-level trends, and anomaly alerts.

- **Apply ML models for real-time anomaly detection**

  Train models on historical Synthea-based data and run inference on real-time streams.

## Architecture

![architecture](https://github.com/user-attachments/assets/c96bc8f2-e121-45a3-b7d3-164284524929)

## Technology Stack

| Layer                   | Tools/Technologies                                         |
|------------------------|------------------------------------------------------------|
| Data Simulation         | Synthea (synthetic EHR), Faker, NumPy, JSON                             |
| Ingestion               | Apache Kafka                                               |
| Streaming               | Apache Spark (Structured Streaming)                        |
| Storage                 | Delta Lake (Parquet + Transaction Logs)                    |
| ML / Anomaly Detection  | PySpark ML, scikit-learn, MLflow |
| Orchestration           | Apache Airflow (ETL)            |
| Query Layer             | Google BigQuery                                            |
| Visualization           | Looker Studio                                              |

## Data Used

### 1. **Synthea-Generated Static Dataset**

- **Source:** `synthea_data/data_for_train.csv`
- **Description:** High-quality synthetic patient data generated by Synthea, representing realistic vitals and clinical conditions.
- **Usage:**
  - Machine learning model training (`RandomForestClassifier`)
  - Feature engineering and baseline distribution reference

**Key Features Used in Training:**

| Feature Name                                                                                  | Description                                             | Type    |
|-----------------------------------------------------------------------------------------------|---------------------------------------------------------|---------|
| `age`                                                                                         | Patient age (derived from date of birth)                | Integer |
| `gender`                                                                                      | Binary encoded gender (0 = Female, 1 = Male)            | Integer |
| `body_mass_index`                                                                             | Body mass index (BMI) in kg/m²                          | Float   |
| `body_temperature`                                                                            | Body temperature in °C                                  | Float   |
| `heart_rate`                                                                                  | Heart rate in beats per minute (bpm)                    | Integer |
| `systolic_blood_pressure`                                                                     | Systolic blood pressure (mmHg)                          | Integer |
| `creatinine`                                                                                  | Creatinine level in mg/dL                               | Float   |
| `alanine_aminotransferase_[enzymatic_activity/volume]_in_serum_or_plasma`                    | Liver enzyme (ALT) level in U/L                         | Float   |
| `glucose`                                                                                     | Blood glucose level in mg/dL                            | Float   |
| `hemoglobin_[mass/volume]_in_blood`                                                           | Hemoglobin concentration in g/dL                        | Float   |
| `leukocytes_[#/volume]_in_blood_by_automated_count`                                           | White blood cell count (10³/μL)                         | Float   |
| `oxygen_saturation_in_arterial_blood`                                                         | Oxygen saturation (SpO₂) percentage                     | Integer |
| `is_ill`                                                                                      | Target label (0 = Healthy, 1 = Ill)                     | Integer |

### 2. **Faker-Based Streaming Simulator**

- **Source:** `src/vitals_kafka_producer.py`
- **Description:** Real-time JSON events simulating live patient vitals, emitted every second to a Kafka topic (`patient_vitals`).
- **Purpose:**
  - Emulates real-time device telemetry
  - Feeds Spark Structured Streaming for Delta Lake ETL and ML scoring

**Fields in Each Streamed JSON Record:**

| Field Name                                                                                   | Description                                             | Type    |
|----------------------------------------------------------------------------------------------|---------------------------------------------------------|---------|
| `patient_id`                                                                                 | Unique patient identifier (UUID)                        | String  |
| `timestamp`                                                                                  | Event timestamp in ISO 8601 (UTC)                       | String  |
| `birthday`                                                                                   | Patient date of birth (used to calculate age)           | String  |
| `gender`                                                                                     | Binary encoded gender (0 = Female, 1 = Male)            | Integer |
| `body_mass_index`                                                                            | BMI in kg/m²                                            | Float   |
| `body_temperature`                                                                           | Body temperature in °C                                  | Float   |
| `heart_rate`                                                                                 | Heart rate in beats per minute                          | Integer |
| `systolic_blood_pressure`                                                                    | Systolic blood pressure (mmHg)                          | Integer |
| `creatinine`                                                                                 | Creatinine level in mg/dL                               | Float   |
| `alanine_aminotransferase_[enzymatic_activity/volume]_in_serum_or_plasma`                   | ALT enzyme level in U/L                                 | Float   |
| `glucose`                                                                                    | Blood glucose level in mg/dL                            | Float   |
| `hemoglobin_[mass/volume]_in_blood`                                                          | Hemoglobin concentration in g/dL                        | Float   |
| `leukocytes_[#/volume]_in_blood_by_automated_count`                                          | White blood cell count (10³/μL)                         | Float   |
| `oxygen_saturation_in_arterial_blood`                                                        | Oxygen saturation percentage                            | Integer |

## Data Model

### Delta Lake Tables

- **`bronze_patient_vitals`**  
  Raw Kafka data ingested in JSON format. No validation or transformation applied.

- **`silver_patient_vitals`**  
  Cleaned and parsed vitals data with derived fields like `age`. 

- **`gold_patient_summary`**  
  Enriched records with model inference scores (e.g., anomaly flags). Optimized for downstream analytics.

### BigQuery Tables

- Mirrors the `gold_patient_summary` table from Delta Lake.
- Used for dashboards, monitoring, and alerts.

**Suggested Views:**
- `abnormal_vitals_log` — Lists all records with flagged anomalies or abnormal ranges.
- `average_vitals_by_age_gender` — Aggregates vitals across age groups and gender.
- `oxygen_alerts_dashboard` — Shows patients with low oxygen saturation (<90%) over time.
 
## ML Model

**Objective:**  
Identify abnormal patient vitals in real time for early clinical intervention.

**Approach:**  
- Trained a supervised **Random Forest Classifier** using labeled Synthea data (`is_ill`)
- Handled class imbalance using **SMOTE** to improve detection of rare illness cases
- Persisted model with **Joblib** for real-time inference

**Streaming Workflow:**  
1. Kafka ingests simulated patient vitals  
2. Spark Streaming loads model and scores each record  
3. Anomaly predictions are appended to the **Gold Delta Table**  
4. Results are synced to BigQuery for visualization and alerting

## Project Files

1. **`synthea_data/`** – Static Synthea-generated patient data used for model training (`data_for_train.csv`).
2. **`src/prepare_data.py`** – Cleans and transforms static data for training.
3. **`src/train_model.py`** – Trains the classification model on labeled vitals and saves it.
4. **`models/illness_classifier.pkl`** – Serialized trained model for real-time inference.
5. **`src/vitals_kafka_producer.py`** – Simulates real-time vitals and streams them to Kafka.
6. **`delta_lake_setup/schema_bronze.json`** – Schema for raw Kafka data in Bronze table.
7. **`delta_lake_setup/schema_silver.json`** – Schema for cleaned records in Silver table.
8. **`delta_lake_setup/schema_gold.json`** – Schema for enriched records with predictions in Gold table.
9. **`src/spark_streaming_job.py`** – Spark job that ingests from Kafka and writes to Bronze → Silver → Gold layers.
10. **`src/bigquery_loader.py`** – Loads curated Gold data into BigQuery for reporting.
11. **`dags/etl_pipeline.py`** – Airflow DAG to schedule and manage BigQuery loading.
12. **`notebooks/pipeline_walkthrough.ipynb`** – Interactive setup guide and walkthrough of key components.
13. **`notebooks/visualization_insights.ipynb`** – Visual analysis of Gold layer (e.g., alerts, trends, patient summaries).

## License

This project uses simulated patient data generated by Synthea, Faker, and custom scripts for educational and research purposes only. The data and dashboards are not based on real patients or real-world trends.

**Disclaimer:**

- The insights, trends, and anomalies presented in this project exist solely within the simulated environment. They should not be interpreted as medical findings, healthcare insights, or clinical recommendations. This project is intended to demonstrate a data engineering and analytics pipeline, not to represent real medical analysis.

- Do not use any of the generated reports, visualizations, or data for decision-making in real healthcare or diagnostics contexts.

---
